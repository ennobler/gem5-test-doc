---
title: "Building"
date: 2018-05-12T21:14:19-04:00
draft: false
weight: 30
---

Let’s start by building a basic x86 system. Currently, you must compile gem5
separately for every ISA that you want to simulate. Additionally, if using
ruby, you have to have separate compilations for every cache coherence
protocol.

To build gem5, we will use SCons. SCons uses the SConstruct file
(gem5/SConstruct) to set up a number of variables and then uses the SConscript
file in every subdirectory to find and compile all of the gem5 source.

SCons automatically creates a gem5/build directory when first executed. In this
directory you’ll find the files generated by SCons, the compiler, etc. There
will be a separate directory for each set of options (ISA and cache coherence
protocol) that you use to compile gem5.

There are a number of default compilations options in the build_opts directory.
These files specify the parameters passed to SCons when initially building
gem5. We’ll use the X86 defaults and specify that we want to compile all of the
CPU models.

``scons CPU_MODELS="AtomicSimpleCPU,MinorCPU,O3CPU,TimingSimpleCPU" build/X86/gem5.opt -j`nproc` ``

{{% notice note %}}
To build a different architecture (e.g. ARM) substitute X86 for that architecture in 
the commoand line above
{{% /notice %}}

The main argument passed to SCons is what you want to build,
build/X86/gem5.opt. In this case, we are building gem5.opt (an optimized binary
with debug symbols). We want to build gem5 in the directory build/X86. Since
this directory currently doesn’t exist, SCons will look in build_opts to find
the default parameters for X86. (Note: `-j9` is being used to parallelize the build and
you should choose an appropriate number for
your machine, usually cores+1.)

The output should look something like below:

```
scons: Reading SConscript files ...
Mercurial libraries cannot be found, ignoring style hook.  If
you are a gem5 developer, please fix this and run the style
hook. It is important.

Checking for leading underscore in global variables...(cached) no
Checking for C header file Python.h... (cached) yes
Checking for C library pthread... (cached) yes
Checking for C library dl... (cached) yes
Checking for C library util... (cached) yes
Checking for C library m... (cached) yes
Checking for C library python2.7... (cached) yes
Checking for accept(0,0,0) in C++ library None... (cached) yes
Checking for zlibVersion() in C++ library z... (cached) yes
Checking for GOOGLE_PROTOBUF_VERIFY_VERSION in C++ library protobuf... (cached) yes
Checking for clock_nanosleep(0,0,NULL,NULL) in C library None... (cached) no
Checking for clock_nanosleep(0,0,NULL,NULL) in C library rt... (cached) yes
Checking for timer_create(CLOCK_MONOTONIC, NULL, NULL) in C library None... (cached) yes
Checking for C library tcmalloc... (cached) yes
Checking for C header file fenv.h... (cached) yes
Checking for C header file linux/kvm.h... (cached) yes
Checking size of struct kvm_xsave ... (cached) yes
Checking for member exclude_host in struct perf_event_attr...(cached) yes
 ....
 .... <lots of output>
 ....
 [    LINK]  -> X86/gem5.opt
scons: done building targets.
```

{{% notice tip %}}
If you see an error `Error: gcc version 4.6 or newer required.` you need a newer version of gcc installed.
{{% /notice %}}

{{% notice tip %}}
If you see an error `Error: SWIG version 2.0.4 or newer required.`  you need a newer version of swig installed.
{{% /notice %}}

{{% notice tip %}}
If you see an error `Error: Can't find version of M4 macro processor.  Please install M4 and try again.` you need to install m4 and
possible autotools: `sudo apt install automake`
{{% /notice %}}

{{% notice tip %}}
If you see an error `TypeError: 'dict' object is not callable` and and are using a non-default version of Python,
you may need to force scons to use a specific version of python: ``python `which scons` build/X86/gem5.opt``

